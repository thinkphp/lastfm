var Lastfm=new Class({Implements:[Events,Options],options:{username:'thinkphp',where:'result',badgeid:'badge',badgeclass:'lastfm',amount:10},initialize:function(options){this.setOptions(options);this.tpl="<li><a href='{link}'>{title}</a> <div>{pubDate}</div></li>";this.badgeid=this.options.badgeid+(+new Date().getTime());this._callData()},_callData:function(){var user=this.options.username,srcurl="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D%22http%3A%2F%2Fws.audioscrobbler.com%2F1.0%2Fuser%2F"+user+"%2Frecenttracks.rss%22";new Request.JSONP({url:srcurl,data:{format:'json',diagnostics:false},onRequest:function(){if(window.console){console.log('Requesting...')}this.fireEvent('request')}.bind(this),onComplete:function(data){if(window.console){console.log('Completed!')}this._retrieveData(data)}.bind(this)}).send()},_retrieveData:function(dataset){if(dataset.query.results!==null){this._displayData(dataset)}else{this._handleError()}},_displayData:function(dataset){this.fireEvent('complete',[dataset]);var out=$(this.options.where),items=dataset.query.results.item,n=items.length,output='',ul=new Element('ul',{id:this.badgeid,class:this.options.badgeclass});for(var i=0;i<n;i++){output+=this.tpl.substitute(items[i])}ul.set('html',output);out.appendChild(ul);$(this.options.where).getElements("a")[0].focus()},_handleError:function(){$(this.options.where).set('html','<span><b>User Not Found</b></span>')}});Element.implement({lastfm:function(opts){var where=this.id,username=opts.username;new Lastfm({username:username,where:where,onRequest:function(){$(where).set('text','Loading...')},onComplete:function(){$(where).set('text','')}})}});