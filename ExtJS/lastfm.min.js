Ext.override(Ext.Element,{lastfm:function(username){new Lastfm(username,this.id)}});function Lastfm(username,where){var options={username:"thinkphp",where:"result",badgeid:"badge",badgeclass:"lastfm",amount:10};options.username=username||options.username;options.where=where||options.where;var tpl="<li><a href='{link}'>{title}</a> <div>{pubDate}</div></li>",badgeid=options.badgeid+(+new Date().getTime());_callData();function _callData(){var user=options.username;Ext.Ajax.request({url:"proxy.php",params:{user:user},method:"GET",success:function(result,request){_retrieveData(eval("("+result.responseText+")"))},failure:function(result,request){_handleError()}})}var _retrieveData=function(dataset){if(dataset.query.results!==null){_displayData(dataset)}else{this._handleError()}};function _displayData(dataset){var out=Ext.get(options.where),items=dataset.query.results.item,n=items.length,ul=Ext.DomHelper.append(out,{tag:"ul",id:badgeid,cls:options.badgeclass});var t=new Ext.Template(tpl);for(var i=0;i<n;i++){t.append(ul,items[i])}}function _handleError(){Ext.get(options.where).innerHTML="<span><b>User Not Found</b></span>"}};