/**
 * Plugin: jquery.lastfm
 * 
 * Version: 1.0.0
 * (c) Copyright 2011, Adrian Statescu
 * 
 * Description: jQuery Plugin for recently listened tracks
 * 
 **/
!function(a){var b=function(a,b){return a.replace(RegExp("{([^{}]*)}","gi"),function(a,c){return b[c]})};a.template=b}(this),function(a){a.fn.lastfm=function(b){function d(c,d){var e=a(d),f=b.tpl,g=d,h=c.query.results.item,i=h.length,j="",k=a("<ul/>",{"class":b.badgeclass,id:b.badgeid});for(var l=0;l<i;l++)j+=template(f,h[l]);k.html(j),e.append(k)}var c={username:"thinkphp",where:"result",badgeid:"badge",badgeclass:"lastfm",amount:10,tpl:"<li><a href='{link}'>{title}</a> <div>{pubDate}</div></li>"},b=a.extend(c,b);return this.each(function(c,e){$e=a(e),b.badgeid=b.badgeid+ +(new Date).getTime();var f=b.username,g="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D%22http%3A%2F%2Fws.audioscrobbler.com%2F1.0%2Fuser%2F"+f+"%2Frecenttracks.rss%22&format=json";a.ajax({type:"GET",url:g,dataType:"json",success:function(a){a&&(window.console&&console.log("Completed!"),d(a,e))}})})}}(jQuery)

