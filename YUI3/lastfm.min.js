YUI.add("basic-plugin",function(Y){Y.namespace("Widgets").Lastfm=Y.Base.create("Lastfm",Y.Plugin.Base,[],{_handle:null,initializer:function(){this._handle=this.get("host");var options={username:"thinkphp",where:"result",badgeid:"badge",badgeclass:"lastfm",amount:10},tpl="<li><a href='{link}'>{title}</a> <div>{pubDate}</div></li>",badgeid=options.badgeid+(+new Date().getTime());options.where=this._handle.get("id");options.username=this._handle.getAttribute("class");Y.one("#"+options.where).set("innerHTML","Loading...");_callData();function _callData(){var user=options.username,api="http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20rss%20where%20url%3D%22http%3A%2F%2Fws.audioscrobbler.com%2F1.0%2Fuser%2F"+user+"%2Frecenttracks.rss%22&format=json";Y.jsonp(api+"&callback={callback}",handleJSONP)}function handleJSONP(data){_retrieveData(data)}function _retrieveData(dataset){if(dataset.query.results!==null){_displayData(dataset)}else{_handleError()}}function _displayData(dataset){var out=Y.one("#"+options.where),items=dataset.query.results.item,n=items.length,output="";out.set("innerHTML","");var ul=Y.Node.create("<ul class='"+options.badgeclass+"' id='"+options.badgeid+"'></ul>");for(var i=0;i<n;i++){output+=template(tpl,items[i])}ul.set("innerHTML",output);out.appendChild(ul);var done=Y.one("#"+options.where+" a");done.focus()}function _handleError(){Y.one("#"+options.where).set("innerHTML","<span><b>User Not Found</b></span>")}},destructor:function(){this._handle.detach();this._handle=null}},{NS:"bp",ATTRS:{color:{value:"#00F"}}})},"0.1",{requires:["base","plugin","node","jsonp"]});